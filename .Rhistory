wc_not_host_wins
wins
wcmatches_tidy %>%
group_by(winning_team) %>%
summarise(total_wins = n()) %>%
rename(country = winning_team) %>%
full_join(wcmatches_tidy1) %>%
replace_na(list(matches_won_hometeam = 0)) %>%
mutate(wins_not_host = total_wins - host_wins) %>%
select(country, wins_not_host)
wcmatches_tidy
wcmatches_tidy %>%
group_by(winning_team) %>%
summarise(total_wins = n())
wcmatches_tidy1
wcmatches_tidy %>%
group_by(winning_team) %>%
summarise(total_wins = n()) %>%
rename(country = winning_team) %>%
full_join(wcmatches_tidy1)
wcmatches_tidy1 <- wcmatches_tidy %>%
filter(country == home_team, country == winning_team) %>%
select(year, country, stage_status, home_team, win_outcome) %>%
group_by(country) %>%
summarise(host_wins = n())
wc_host_wins <- wcmatches_tidy1 %>%
left_join(wc_total_matches, by = 'country') %>%
group_by(country) %>%
summarise(host_win = round(host_wins * 100 / total_possible, 2)) %>%
replace_na(list(proportion_win = 0))
wc_not_host_wins <- wcmatches_tidy %>%
group_by(winning_team) %>%
summarise(total_wins = n()) %>%
rename(country = winning_team) %>%
full_join(wcmatches_tidy1) %>%
replace_na(list(host_wins = 0)) %>%
mutate(wins_not_host = total_wins - host_wins) %>%
select(country, wins_not_host)
home_matches_played <- wcmatches_tidy %>%
filter(country != home_team) %>%
group_by(home_team) %>%
summarise(home_played = n()) %>%
rename(country = home_team)
away_matches_played <- wcmatches_tidy %>%
group_by(away_team) %>%
summarise(away_played = n()) %>%
rename(country = away_team)
wc_win_prop_combine <- home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_host_wins, by = 'country') %>%
replace_na(list(matches_won = 0)) %>%
mutate(total_played = home_played + away_played) %>%
group_by(country) %>%
summarise(not_host_wins_prop = round(wins_not_host*100/total_played,2)) %>%
right_join(prop_host, by = 'country')
ome_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_host_wins, by = 'country') %>%
replace_na(list(matches_won = 0)) %>%
mutate(total_played = home_played + away_played) %>%
group_by(country)
home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_host_wins, by = 'country') %>%
replace_na(list(matches_won = 0)) %>%
mutate(total_played = home_played + away_played) %>%
group_by(country)
wcmatches_tidy1
wc_not_host_wins
wc_host_wins
wc_not_host_wins <- wcmatches_tidy %>%
group_by(winning_team) %>%
summarise(total_wins = n()) %>%
rename(country = winning_team) %>%
full_join(wcmatches_tidy1) %>%
replace_na(list(host_wins = 0)) %>%
mutate(not_host_wins = total_wins - host_wins) %>%
select(country, wins_not_host)
wc_not_host_wins <- wcmatches_tidy %>%
group_by(winning_team) %>%
summarise(total_wins = n()) %>%
rename(country = winning_team) %>%
full_join(wcmatches_tidy1) %>%
replace_na(list(host_wins = 0)) %>%
mutate(not_host_wins = total_wins - host_wins) %>%
select(country, not_host_wins)
home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_host_wins, by = 'country')
wc_win_prop_combine <- home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_host_wins, by = 'country') %>%
replace_na(list(host_wins = 0)) %>%
mutate(total_played = home_played + away_played) %>%
group_by(country) %>%
summarise(not_host_wins_prop = round(not_host_wins*100/total_played,2)) %>%
right_join(prop_host, by = 'country')
wc_win_prop_combine <- home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_not_host_wins, by = 'country') %>%
replace_na(list(host_wins = 0)) %>%
mutate(total_played = home_played + away_played) %>%
group_by(country) %>%
summarise(not_host_wins_prop = round(not_host_wins*100/total_played,2)) %>%
right_join(prop_host, by = 'country')
wc_win_prop_combine
wc_groupstage_matches %>%
full_join(wc_elimstage_matches1, by = c('year', 'country')) %>%
replace_na(list(group_stage_matches_played = 0)) %>%
mutate(total_possible_matches = group_stage_matches_played + elim_matches_played) %>%
select(country, total_possible_matches) %>%
group_by(country) %>%
summarise(total_possible = sum(total_possible_matches))
wc_total_matches
home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_not_host_wins, by = 'country') %>%
replace_na(list(host_wins = 0)) %>%
mutate(total_played = home_played + away_played) %>%
group_by(country)
home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_not_host_wins, by = 'country') %>%
replace_na(list(host_wins = 0), list(not_host_wins = 0))
home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_not_host_wins, by = 'country')
home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_not_host_wins, by = 'country') %>%
replace_na(list(not_host_wins = 0))
home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_not_host_wins, by = 'country') %>%
replace_na(list(not_host_wins = 0)) %>%
mutate(total_played = home_played + away_played) %>%
group_by(country) %>%
summarise(not_host_wins_prop = round(not_host_wins*100/total_played,2)) %>%
right_join(prop_host, by = 'country')
wcmatches_tidy %>%
filter(home_team == 'Chile' | away_team == 'Chile')
# Group stage matches
wc_groupstage_matches <- wcmatches_tidy %>%
filter(stage_status == 'Group Stage', country == home_team) %>%
group_by(year, country) %>%
summarise(group_stage_matches_played = n())
# Knockout stage, non-1950
wc_elimstage_matches <- wcmatches_tidy %>%
filter(year != '1950', stage_status != 'Group Stage') %>%
group_by(year, country) %>%
summarise(elim_matches_played = n_distinct(stage_status))
# Knockout stage, 1950
wc_elimstage_matches1 <- wcmatches_tidy %>%
filter(year == '1950', stage_status != 'Group Stage', country == home_team) %>%
group_by(year, country) %>%
summarise(elim_matches_played = n()) %>%
bind_rows(wc_elimstage_matches)
# Merge group stage and knockout stage
wc_total_matches <- wc_groupstage_matches %>%
full_join(wc_elimstage_matches1, by = c('year', 'country')) %>%
replace_na(list(group_stage_matches_played = 0)) %>%
mutate(total_possible_matches = group_stage_matches_played + elim_matches_played) %>%
select(country, total_possible_matches) %>%
group_by(country) %>%
summarise(total_possible = sum(total_possible_matches))
# Proportion
wcmatches_tidy1 <- wcmatches_tidy %>%
filter(country == home_team, country == winning_team) %>%
select(year, country, stage_status, home_team, win_outcome) %>%
group_by(country) %>%
summarise(host_wins = n())
wc_host_wins <- wcmatches_tidy1 %>%
left_join(wc_total_matches, by = 'country') %>%
group_by(country) %>%
summarise(host_win = round(host_wins * 100 / total_possible, 2)) %>%
replace_na(list(proportion_win = 0))
wc_not_host_wins <- wcmatches_tidy %>%
group_by(winning_team) %>%
summarise(total_wins = n()) %>%
rename(country = winning_team) %>%
full_join(wcmatches_tidy1) %>%
replace_na(list(host_wins = 0)) %>%
mutate(not_host_wins = total_wins - host_wins) %>%
select(country, not_host_wins)
home_matches_played <- wcmatches_tidy %>%
filter(country != home_team) %>%
group_by(home_team) %>%
summarise(home_played = n()) %>%
rename(country = home_team)
away_matches_played <- wcmatches_tidy %>%
group_by(away_team) %>%
summarise(away_played = n()) %>%
rename(country = away_team)
wc_win_prop_combine <- home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_not_host_wins, by = 'country') %>%
replace_na(list(host_wins = 0)) %>%
mutate(total_played = home_played + away_played) %>%
group_by(country) %>%
summarise(not_host_wins_prop = round(not_host_wins*100/total_played,2)) %>%
right_join(prop_host, by = 'country')
# val code
wcmatches_tidy2 <- wcmatches_tidy %>%
filter(country == home_team, win_outcome == "Home") %>%
select(year, country, stage_status, home_team, win_outcome) %>%
group_by(country) %>%
summarise(matches_won_hometeam = n())
wcmatches_tidy3 <- wcmatches_tidy%>%
group_by(winning_team)%>%
select(year,country,stage_status,away_team,win_outcome,winning_team)%>%
summarise(actual_win = n())%>%
left_join(wcmatches_tidy2, by = c('winning_team' = 'country'))%>%
na.omit()%>%
mutate(away_win = actual_win - matches_won_hometeam ) %>%
left_join(wcmatches_tidy1, by = c('winning_team' = 'country'))%>%
mutate(proportion_away_win = round(away_win/actual_win * 100,2))%>%
select(winning_team, proportion_away_win)
combine_data <- wcmatches_tidy3%>%
left_join(wcmatches_tidy1, by =c('winning_team'= 'country'))
ggplot(data = combine_data, aes(x = proportion_away_win, y = proportion_win))+
geom_point()+
geom_text(aes(label = winning_team), hjust= 0.5,vjust = -0.5,angle = 0,size = 3) +
ylim(0,110)+
geom_abline(color = 'red',linetype=2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Win when Away",
y = "Proportion of Win at Home")+
theme_minimal()
combine_data
ggplot(data = combine_data, aes(x = proportion_away_win, y = host_win))+
geom_point()+
geom_text(aes(label = winning_team), hjust= 0.5,vjust = -0.5,angle = 0,size = 3) +
ylim(0,110)+
geom_abline(color = 'red',linetype=2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Win when Away",
y = "Proportion of Win at Home")+
theme_minimal()
combine_data
ggplot(data = combine_data, aes(x = proportion_away_win, y = host_wins))+
geom_point()+
geom_text(aes(label = winning_team), hjust= 0.5,vjust = -0.5,angle = 0,size = 3) +
ylim(0,110)+
geom_abline(color = 'red',linetype=2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Win when Away",
y = "Proportion of Win at Home")+
theme_minimal()
wcmatches_tidy1
wc_host_wins
ggplot(data = combine_data, aes(x = proportion_away_win, y = host_wins))+
geom_point()+
geom_text(aes(label = winning_team), hjust= 0.5,vjust = -0.5,angle = 0,size = 3) +
ylim(0,110)+
geom_abline(color = 'red',linetype=2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Win when Away",
y = "Proportion of Win at Home")+
theme_minimal()
combine_data <- wcmatches_tidy3%>%
left_join(wcmatches_tidy1, by =c('winning_team'= 'country'))
ggplot(data = combine_data, aes(x = proportion_away_win, y = host_wins))+
geom_point()+
geom_text(aes(label = winning_team), hjust= 0.5,vjust = -0.5,angle = 0,size = 3) +
ylim(0,110)+
geom_abline(color = 'red',linetype=2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Win when Away",
y = "Proportion of Win at Home")+
theme_minimal()
wcmatches_tidy3 <- wcmatches_tidy%>%
group_by(winning_team)%>%
select(year,country,stage_status,away_team,win_outcome,winning_team)%>%
summarise(actual_win = n())%>%
left_join(wcmatches_tidy2, by = c('winning_team' = 'country'))%>%
na.omit()%>%
mutate(away_win = actual_win - matches_won_hometeam ) %>%
left_join(wcmatches_tidy1, by = c('winning_team' = 'country'))%>%
mutate(proportion_away_win = round(away_win/actual_win * 100,2))%>%
select(winning_team, proportion_away_win)
combine_data <- wcmatches_tidy3%>%
left_join(wcmatches_tidy1, by =c('winning_team'= 'country'))
ggplot(data = combine_data, aes(x = proportion_away_win, y = host_wins))+
geom_point()+
geom_text(aes(label = winning_team), hjust= 0.5,vjust = -0.5,angle = 0,size = 3) +
ylim(0,110)+
geom_abline(color = 'red',linetype=2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Win when Away",
y = "Proportion of Win at Home")+
theme_minimal()
ggplot(data = combine_data, aes(x = proportion_win_away, y = proportion_win)) +
geom_point() +
geom_text_repel(aes(label = country), hjust = 0.5, vjust = -0.5, size = 3) + #angle = -30
ylim(0, 110) +
geom_abline(color = 'red', linetype = 2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Wins when Away",
y = "Proportion of Wins at Home") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5, size = 20))
knitr::opts_chunk$set(echo = TRUE)
library(tidytuesdayR)
library(readr)
library(tidyverse)
library(stringr)
library(forcats)
library(maps)
library(ggthemes)
library(ggrepel)
install.packages('ggrepel')
library(ggrepel)
# Group stage matches
wc_groupstage_matches <- wcmatches_tidy %>%
filter(stage_status == 'Group Stage', country == home_team) %>%
group_by(year, country) %>%
summarise(group_stage_matches_played = n())
# Knockout stage, non-1950
wc_elimstage_matches <- wcmatches_tidy %>%
filter(year != '1950', stage_status != 'Group Stage') %>%
group_by(year, country) %>%
summarise(elim_matches_played = n_distinct(stage_status))
# Knockout stage, 1950
wc_elimstage_matches1 <- wcmatches_tidy %>%
filter(year == '1950', stage_status != 'Group Stage', country == home_team) %>%
group_by(year, country) %>%
summarise(elim_matches_played = n()) %>%
bind_rows(wc_elimstage_matches)
# Merge group stage and knockout stage
wc_total_matches <- wc_groupstage_matches %>%
full_join(wc_elimstage_matches1, by = c('year', 'country')) %>%
replace_na(list(group_stage_matches_played = 0)) %>%
mutate(total_possible_matches = group_stage_matches_played + elim_matches_played) %>%
select(country, total_possible_matches) %>%
group_by(country) %>%
summarise(total_possible = sum(total_possible_matches))
# Proportion
wcmatches_tidy1 <- wcmatches_tidy %>%
filter(country == home_team, country == winning_team) %>%
select(year, country, stage_status, home_team, win_outcome) %>%
group_by(country) %>%
summarise(host_wins = n())
wc_host_wins <- wcmatches_tidy1 %>%
left_join(wc_total_matches, by = 'country') %>%
group_by(country) %>%
summarise(host_win = round(host_wins * 100 / total_possible, 2)) %>%
replace_na(list(proportion_win = 0))
wc_not_host_wins <- wcmatches_tidy %>%
group_by(winning_team) %>%
summarise(total_wins = n()) %>%
rename(country = winning_team) %>%
full_join(wcmatches_tidy1) %>%
replace_na(list(host_wins = 0)) %>%
mutate(not_host_wins = total_wins - host_wins) %>%
select(country, not_host_wins)
home_matches_played <- wcmatches_tidy %>%
filter(country != home_team) %>%
group_by(home_team) %>%
summarise(home_played = n()) %>%
rename(country = home_team)
away_matches_played <- wcmatches_tidy %>%
group_by(away_team) %>%
summarise(away_played = n()) %>%
rename(country = away_team)
wc_win_prop_combine <- home_matches_played %>%
full_join(away_matches_played, by = 'country') %>%
full_join(wc_not_host_wins, by = 'country') %>%
replace_na(list(host_wins = 0)) %>%
mutate(total_played = home_played + away_played) %>%
group_by(country) %>%
summarise(not_host_wins_prop = round(not_host_wins*100/total_played,2)) %>%
right_join(prop_host, by = 'country')
# val code
wcmatches_tidy2 <- wcmatches_tidy %>%
filter(country == home_team, win_outcome == "Home") %>%
select(year, country, stage_status, home_team, win_outcome) %>%
group_by(country) %>%
summarise(matches_won_hometeam = n())
wcmatches_tidy3 <- wcmatches_tidy%>%
group_by(winning_team)%>%
select(year,country,stage_status,away_team,win_outcome,winning_team)%>%
summarise(actual_win = n())%>%
left_join(wcmatches_tidy2, by = c('winning_team' = 'country'))%>%
na.omit()%>%
mutate(away_win = actual_win - matches_won_hometeam ) %>%
left_join(wcmatches_tidy1, by = c('winning_team' = 'country'))%>%
mutate(proportion_away_win = round(away_win/actual_win * 100,2))%>%
select(winning_team, proportion_away_win)
combine_data <- wcmatches_tidy3%>%
left_join(wcmatches_tidy1, by =c('winning_team'= 'country'))
ggplot(data = combine_data, aes(x = proportion_away_win, y = host_wins))+
geom_point()+
geom_text(aes(label = winning_team), hjust= 0.5,vjust = -0.5,angle = 0,size = 3) +
ylim(0,110)+
geom_abline(color = 'red',linetype=2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Win when Away",
y = "Proportion of Win at Home")+
theme_minimal()
wcmatches_away <- wcmatches_tidy %>%
filter(stage_status == 'Group Stage')%>%
filter(country != home_team)%>%
group_by(year, country, away_team)%>%
summarise(groupstage_matches = n())
wc_elimstage_away <- wcmatches_tidy %>%
filter(year != 1950)%>%
filter(country != home_team)%>%
filter(stage_status != 'Group Stage')%>%
group_by(year, country, away_team)%>%
summarize(elimstage_matches = n_distinct(stage_status))
wc_elimstage_away1 <- wcmatches_tidy %>%
filter(year == 1950)%>%
filter(country != home_team)%>%
filter(stage_status != 'Group Stage')%>%
group_by(year, country, away_team)%>%
summarise(elimstage_matches = n())%>%
bind_rows(wc_elimstage_away)
wc_total_matches1 <- wcmatches_away %>%
left_join(wc_elimstage_away1, by = c("year", "country", "away_team"))%>%
replace_na(list(elimstage_matches = 0))%>%
mutate(total_possible_matches = groupstage_matches + elimstage_matches)%>%
select(country, total_possible_matches)%>%
group_by(country)%>%
summarise(total_possible = sum(total_possible_matches))
wcmatches_tidy2 <- wcmatches_tidy %>%
filter(country != home_team) %>%
select(year, country, stage_status, away_team, win_outcome) %>%
filter(win_outcome == "Away") %>%
group_by(year, country) %>%
summarise(matches_won_awayteam = n()) %>%
left_join(wc_total_matches1, by = 'country') %>%
group_by(country) %>%
summarise(proportion_win_away = sum(round(matches_won_awayteam * 100 / total_possible, 2)))
combine_data <- wcmatches_tidy2 %>%
left_join(wcmatches_tidy1, by = 'country')
ggplot(data = combine_data, aes(x = proportion_win_away, y = proportion_win)) +
geom_point() +
geom_text_repel(aes(label = country), hjust = 0.5, vjust = -0.5, size = 3) + #angle = -30
ylim(0, 110) +
geom_abline(color = 'red', linetype = 2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Wins when Away",
y = "Proportion of Wins at Home") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5, size = 20))
combine_data
ggplot(data = combine_data, aes(x = proportion_win_away, y = host_win)) +
geom_point() +
geom_text_repel(aes(label = country), hjust = 0.5, vjust = -0.5, size = 3) + #angle = -30
ylim(0, 110) +
geom_abline(color = 'red', linetype = 2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Wins when Away",
y = "Proportion of Wins at Home") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5, size = 20))
ggplot(data = combine_data, aes(x = proportion_win_away, y = host_wins)) +
geom_point() +
geom_text_repel(aes(label = country), hjust = 0.5, vjust = -0.5, size = 3) + #angle = -30
ylim(0, 110) +
geom_abline(color = 'red', linetype = 2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Wins when Away",
y = "Proportion of Wins at Home") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5, size = 20))
ggplot(data = combine_data, aes(x = proportion_away_win, y = host_wins))+
geom_point()+
geom_text(aes(label = winning_team), hjust= 0.5,vjust = -0.5,angle = 0,size = 3) +
ylim(0,110)+
geom_abline(color = 'red',linetype=2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Win when Away",
y = "Proportion of Win at Home")+
theme_minimal()
combine_data <- wcmatches_tidy3%>%
left_join(wcmatches_tidy1, by =c('winning_team'= 'country'))
ggplot(data = combine_data, aes(x = proportion_away_win, y = host_wins))+
geom_point()+
geom_text(aes(label = winning_team), hjust= 0.5,vjust = -0.5,angle = 0,size = 3) +
ylim(0,110)+
geom_abline(color = 'red',linetype=2) +
labs(title = 'Host Country Performance VS when Away',
x = "Proportion of Win when Away",
y = "Proportion of Win at Home")+
theme_minimal()
# Total matches played per host country
wcmatches_tidy %>%
filter(country == home_team) %>%
group_by(country) %>%
summarise(total_matches_played = n())
# Total matches played per host country
wc_host_matches_played <- wcmatches_tidy %>%
filter(country == home_team) %>%
group_by(country) %>%
summarise(total_matches_played = n())
wcmatches_tidy1
wcmatches_tidy1
wc_host_matches_played %>%
full_join(wcmatches_tidy1) %>%
mutate(host_win_proportion = host_wins*100/total_matches_played)
wc_host_wins_prop -> wc_host_matches_played %>%
full_join(wcmatches_tidy1) %>%
mutate(host_win_proportion = round(host_wins*100/total_matches_played, 2))
wc_host_wins_prop -> wc_host_matches_played %>%
full_join(wcmatches_tidy1) %>%
mutate(host_win_proportion = round(host_wins*100/total_matches_played, 2))
wc_host_wins_prop <- wc_host_matches_played %>%
full_join(wcmatches_tidy1) %>%
mutate(host_win_proportion = round(host_wins*100/total_matches_played, 2))
combine_data
combine_data
